<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TVC SPORT</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Arial', sans-serif;
            color: #333;
        }
        .card {
            margin-top: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            background-color: #fff;
        }
        .card-header {
            background-color: #007bff;
            color: #fff;
            border-top-left-radius: 10px;
            border-top-right-radius: 10px;
        }
        .dropdown-menu {
            min-width: 100%;
            border-radius: 0;
            background-color: #fff;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        .dropdown-item {
            color: #333;
        }
        .dropdown-item.dark-mode {
            color: #f8f9fa;
        }
        .dropdown-item:hover, .dropdown-item:focus {
            text-decoration: none;
            background-color: #e9ecef;
        }
        #video {
            width: 100%;
            height: auto;
            border-radius: 10px;
        }
        .dropdown-toggle::after {
            display: none;
        }
        body.dark-mode {
            background-color: #333;
            color: #f8f9fa;
        }
        body.dark-mode .card {
            background-color: #444;
        }
        body.dark-mode .card-header {
            background-color: #007bff;
        }
        body.dark-mode .dropdown-menu {
            background-color: #444;
        }
        body.dark-mode .dropdown-item:hover {
            background-color: #555;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        <h4 class="card-title mb-0">TVC SPORT</h4>
                    </div>
                    <div class="card-body">
                        <div class="dropdown">
                            <button class="btn btn-secondary dropdown-toggle" type="button" id="linkSelector" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Select Video
                            </button>
                            <button id="darkModeToggle" class="btn btn-secondary">
                                Toggle Dark Mode
                            </button>
                            <div class="dropdown-menu" aria-labelledby="linkSelector" id="dropdownMenu">
                                <!-- Dynamically populated dropdown items -->
                            </div>
                        </div>
                        <video id="video" class="mt-3" controls></video>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
            var video = document.getElementById('video');
            var hls = new Hls();

            // Function to load and play a video
            // Function to load and play a video
      function loadVideo(link, channel) {
          if (hls.destroyed) {
              hls = new Hls();
          }
          hls.loadSource(link);
          hls.attachMedia(video);
          hls.on(Hls.Events.MANIFEST_PARSED, function() {
              video.play();
          });
          // Update the dropdown button text
          $('#linkSelector').text(channel);

          // Save the selected channel in a cookie
          setCookie('selectedChannel', channel, 365);
      }

            // Fetch the JSON file
            fetch('todayMatches.json')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    populateDropdown(data);
                })
                .catch(error => {
                    console.error('There has been a problem with your fetch operation:', error);
                });

            // Function to populate the dropdown menu with fetched m3u8 links
            function populateDropdown(m3u8Links) {
          var dropdownMenu = document.getElementById('dropdownMenu');
          dropdownMenu.innerHTML = ''; // Clear existing items

          m3u8Links.forEach(function(link) {
              if (!link.streamUrl || !link.streamName) {
                  console.warn('Invalid link object:', link);
                  return;
              }
              var dropdownItem = document.createElement('a');
              dropdownItem.className = 'dropdown-item';
              dropdownItem.href = '#';
              dropdownItem.setAttribute('data-link', link.streamUrl);
              dropdownItem.setAttribute('data-channel', link.streamName);
              dropdownItem.textContent = link.streamName;
              dropdownItem.addEventListener('click', function(e) {
                  e.preventDefault();
                  loadVideo(this.getAttribute('data-link'), this.getAttribute('data-channel'));
              });
              dropdownMenu.appendChild(dropdownItem);

              // Check if this is the saved channel and select it
              var savedChannel = getCookie('selectedChannel');
              if (savedChannel === link.streamName) {
                  dropdownItem.click();
              }
          });
      }

            // Function to set a cookie
            function setCookie(name, value, days) {
                var expires = "";
                if (days) {
                    var date = new Date();
                    date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
                    expires = "; expires=" + date.toUTCString();
                }
                document.cookie = name + "=" + (value || "") + expires + "; path=/";
            }

            // Function to get a cookie
            function getCookie(name) {
                var nameEQ = name + "=";
                var ca = document.cookie.split(';');
                for (var i = 0; i < ca.length; i++) {
                    var c = ca[i];
                    while (c.charAt(0) == ' ') c = c.substring(1, c.length);
                    if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
                }
                return null;
            }

            // Function to toggle dark mode
            function toggleDarkMode() {
                var body = document.body;
                body.classList.toggle('dark-mode');

                // Save the user's preference in a cookie
                var isDarkMode = body.classList.contains('dark-mode');
                setCookie('darkMode', isDarkMode ? 'true' : 'false', 365);
            }

            // Event listener for the dark mode toggle button
            document.getElementById('darkModeToggle').addEventListener('click', toggleDarkMode);

            // Check for the dark mode cookie on page load
            window.onload = function() {
                var isDarkMode = getCookie('darkMode') === 'true';
                if (isDarkMode) {
                    document.body.classList.add('dark-mode');
                }
            }
    </script>
  </body>
</html>
